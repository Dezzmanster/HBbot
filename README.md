# Birthday Bot

Телеграм бот для автоматических поздравлений с днем рождения участников чата.

## Возможности

- Автоматическая отправка поздравлений в заданное время
- Генерация уникальных поздравлений с помощью GigaChat
- Хранение информации о пользователях в конфигурационном файле
- Настраиваемый промпт для генерации поздравлений
- Поддержка индивидуальных чатов для каждого пользователя
- Профессиональное логирование всех операций

## Структура проекта

```
HBbot/
├── birthday_bot.py       # Основной модуль бота
├── constants.py          # Константы и настройки
├── users_config.json     # Конфигурация пользователей (не в git)
├── users_config.example.json  # Пример конфигурации
├── birthday_prompt.txt   # Промпт для генерации поздравлений
├── .env                  # Переменные окружения (не в git)
├── .gitignore           # Исключения для git
├── pyproject.toml       # Конфигурация проекта
├── uv.lock              # Файл блокировки зависимостей
└── README.md            # Документация
```

## Архитектура

После рефакторинга код имеет четкую структуру:

- **`BirthdayBot`** - основной класс с разделением на приватные методы
- **Константы** вынесены в отдельный файл для удобства настройки
- **Логирование** на всех уровнях для отладки и мониторинга
- **Обработка ошибок** с fallback механизмами
- **Типизация** для лучшей поддержки IDE и предотвращения ошибок

## Установка и настройка

### 1. Установка зависимостей

Проект использует `uv` для управления зависимостями:

```bash
uv sync
```

### 2. Настройка переменных окружения

Создайте файл `.env` и заполните его:

```env
# Telegram Bot Token (получить у @BotFather)
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# GigaChat API credentials
GIGACHAT_CREDENTIALS=your_gigachat_credentials_here
GIGACHAT_SCOPE=GIGACHAT_API_PERS

# Chat ID чата, куда отправлять поздравления
CHAT_ID=-1001234567890
```

### 3. Настройка пользователей

Скопируйте пример конфигурации и заполните данными:

```bash
cp users_config.example.json users_config.json
```

Отредактируйте файл `users_config.json`:

```json
{
  "birthday_time": "09:00",
  "default_chat_id": -1001234567890,
  "users": [
    {
      "name": "Имя Фамилия",
      "username": "telegram_username",
      "birthday": "DD.MM",
      "chat_id": -1001234567890
    },
    {
      "name": "Другой Пользователь",
      "username": "another_username", 
      "birthday": "DD.MM",
      "chat_id": -1009876543210
    },
    {
      "name": "Третий Пользователь",
      "username": "third_username",
      "birthday": "DD.MM"
    }
  ]
}
```

Где:
- `birthday_time` - время отправки поздравлений в формате ЧЧ:ММ (по умолчанию 09:00)
- `default_chat_id` - chat ID по умолчанию для пользователей без индивидуального chat_id
- `name` - полное имя пользователя
- `username` - имя пользователя в Telegram (без @)
- `birthday` - дата рождения в формате ДД.ММ
- `chat_id` - (опционально) индивидуальный chat ID для конкретного пользователя

**Приоритет выбора chat_id:**
1. Индивидуальный `chat_id` в настройках пользователя
2. `default_chat_id` из конфигурации
3. `CHAT_ID` из `.env` файла

**Важно:** 
- Файл `users_config.json` добавлен в `.gitignore` и не попадает в репозиторий
- Используйте `users_config.example.json` как шаблон для создания своего конфига
- Можно отправлять поздравления в разные чаты для разных пользователей

### 4. Настройка промпта

Отредактируйте файл `birthday_prompt.txt` для изменения стиля поздравлений.

## Запуск

```bash
uv run birthday_bot.py
```

Бот будет:
1. Сразу проверит, есть ли именинники сегодня
2. Запустит планировщик для ежедневной проверки в указанное время

## Логирование

Бот ведет подробные логи работы:
- **Консоль** - основные события и ошибки
- **Файл `birthday_bot.log`** - полная информация для отладки
- Уровни логирования: INFO, WARNING, ERROR, CRITICAL
- Автоматическая ротация и кодировка UTF-8

Примеры логов:
```
2024-01-15 09:00:01 - __main__ - INFO - Проверяем именинников на сегодня...
2024-01-15 09:00:02 - __main__ - INFO - Поздравление отправлено для Иван в чат -1001234567890
2024-01-15 09:00:03 - __main__ - INFO - Бот запущен! Проверка дней рождения каждый день в 09:00
```

## Получение chat_id

Для получения ID чата:
1. Добавьте бота в нужный чат
2. Отправьте любое сообщение в чат
3. Перейдите по ссылке: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Найдите в ответе поле `"chat":{"id": -1001234567890}`
5. Добавьте найденный ID в `.env` файл как `CHAT_ID=-1001234567890`

## Структура проекта

```
HBbot/
├── birthday_bot.py      # Основной файл бота
├── constants.py         # Константы и настройки приложения
├── users_config.json    # Конфигурация пользователей
├── birthday_prompt.txt  # Промпт для генерации поздравлений
├── .env                 # Переменные окружения (не в git)
├── .gitignore          # Исключения для git
├── pyproject.toml      # Конфигурация проекта
└── README.md           # Документация
```
